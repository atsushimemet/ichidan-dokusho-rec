# GA4 カスタムイベント設定・確認ガイド

## 概要
実装したAmazonリンククリック追跡イベント（`amazon_link_click`）をGA4コンソールで確認・設定する手順を説明します。

## 前提条件
- GA4プロパティが設定済み（測定ID: G-8YPNZ4VYKX）
- 管理者権限でGA4にアクセス可能

## 1. リアルタイムでのイベント確認

### 手順
1. GA4プロパティにログイン
2. 左メニューから「レポート」→「リアルタイム」を選択
3. Webサイトで以下の操作を実行：
   - `/results`ページでAmazonリンクをクリック
   - `/search`ページでAmazonリンクをクリック
4. リアルタイムレポートで「イベント数（イベント別）」セクションを確認
5. `amazon_link_click`イベントが表示されることを確認

### 確認ポイント
- イベント名が正しく表示される
- イベント数がクリック回数と一致する
- 複数のページからのイベントが区別される

## 2. イベントレポートでの詳細確認

### 手順
1. 左メニューから「レポート」→「エンゲージメント」→「イベント」を選択
2. イベント一覧で`amazon_link_click`を探す
3. イベント名をクリックして詳細を確認
4. 「イベントパラメータ」タブでパラメータを確認

### 確認すべきパラメータ
- `book_title`: 書籍タイトル
- `book_author`: 著者名
- `book_id`: 書籍ID
- `amazon_url`: AmazonのURL
- `source_page`: ページ種別（results/search）
- `click_position`: クリック位置（resultsページのみ）
- `recommendation_score`: レコメンドスコア（resultsページのみ）

## 3. カスタムディメンションの設定

### 設定手順
1. 左メニューから「設定」→「カスタム定義」→「カスタムディメンション」を選択
2. 「カスタムディメンションを作成」をクリック
3. 以下のディメンションを順次作成：

#### 推奨カスタムディメンション

| ディメンション名 | イベントパラメータ | 説明 |
|-----------------|-------------------|------|
| 書籍タイトル | book_title | クリックされた書籍のタイトル |
| 書籍著者 | book_author | 書籍の著者名 |
| ソースページ | source_page | クリック元ページ（results/search） |
| レコメンドスコア | recommendation_score | 推薦スコア（0-100） |
| クリック位置 | click_position | リスト内での位置 |

### 設定例（書籍タイトル）
- **ディメンション名**: 書籍タイトル
- **範囲**: イベント
- **イベントパラメータ**: book_title
- **説明**: Amazonリンクがクリックされた書籍のタイトル

## 4. カスタムレポートの作成

### 書籍別クリック数レポート

#### 手順
1. 「レポート」→「ライブラリ」を選択
2. 「レポートを作成」→「詳細レポート」を選択
3. 以下の設定でレポートを作成：

#### 設定内容
- **レポート名**: 書籍別Amazonクリック数
- **ディメンション**: 
  - 書籍タイトル
  - 書籍著者
  - ソースページ
- **指標**: 
  - イベント数
  - ユニークユーザー数
- **フィルタ**: イベント名 = amazon_link_click

### ページ別パフォーマンスレポート

#### 設定内容
- **レポート名**: ページ別Amazonクリック分析
- **ディメンション**: 
  - ソースページ
  - クリック位置（resultsページ用）
- **指標**: 
  - イベント数
  - ユニークユーザー数
  - セッション数
- **フィルタ**: イベント名 = amazon_link_click

## 5. コンバージョンイベントの設定（オプション）

### 手順
1. 「設定」→「イベント」を選択
2. `amazon_link_click`イベントを探す
3. 「コンバージョンとしてマークを付ける」をオンにする

### メリット
- コンバージョン率の測定が可能
- GA4の機械学習機能を活用
- より詳細な分析レポートが利用可能

## 6. デバッグビューでの詳細確認

### 有効化手順
1. 「設定」→「DebugView」を選択
2. ブラウザで以下のURLパラメータを追加してアクセス：
   ```
   ?gtm_debug=1
   ```
3. または、ブラウザの開発者ツールで以下を実行：
   ```javascript
   gtag('config', 'G-8YPNZ4VYKX', { debug_mode: true });
   ```

### 確認内容
- イベントの詳細なパラメータ
- 送信タイミング
- エラーの有無

## 7. データの検証

### 確認項目
- [ ] リアルタイムでイベントが表示される
- [ ] 全てのパラメータが正しく送信される
- [ ] resultsページとsearchページで異なるパラメータが送信される
- [ ] click_positionがresultsページでのみ送信される
- [ ] recommendation_scoreがresultsページでのみ送信される

### トラブルシューティング

#### イベントが表示されない場合
1. ブラウザの開発者ツールでコンソールエラーを確認
2. `window.dataLayer`の内容を確認
3. GA4の測定IDが正しいか確認
4. アドブロッカーが無効になっているか確認

#### パラメータが表示されない場合
1. カスタムディメンションが正しく設定されているか確認
2. イベントパラメータ名が一致しているか確認
3. データの反映に24-48時間かかる場合がある

## 8. 定期的な監視・分析

### 推奨監視項目
- 日別・週別のクリック数推移
- 書籍別の人気度ランキング
- ページ別のクリック率
- レコメンドスコアとクリック率の相関

### 分析のポイント
- どの書籍が最もクリックされているか
- resultsページとsearchページでの行動の違い
- レコメンドの効果測定
- ユーザーの興味・関心の傾向

## 9. プライバシー・コンプライアンス

### 注意事項
- 個人を特定できる情報は送信していない
- 書籍情報のみを追跡対象としている
- GDPR/CCPA等の規制に準拠している
- ユーザーの同意が必要な場合は適切に取得する

### データ保持期間
- GA4のデフォルト設定（14ヶ月）を確認
- 必要に応じて保持期間を調整
- 法的要件に応じた設定を行う