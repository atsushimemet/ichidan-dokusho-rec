# ユーザー受け入れテスト仕様書

## 0. テスト準備方法

### 0.1 必要な環境・ツール

#### 0.1.1 開発環境
- **Node.js**: v18.0.0以上
- **npm**: v9.0.0以上
- **Git**: v2.30.0以上
- **ブラウザ**: Chrome最新版、Safari最新版、Firefox最新版

#### 0.1.2 推奨エディタ
- Visual Studio Code
- または任意のコードエディタ

### 0.2 プロジェクトセットアップ

#### 0.2.1 リポジトリのクローン
```bash
# リポジトリをクローン
git clone https://github.com/your-username/ichidan-dokusho-rec.git
cd ichidan-dokusho-rec

# 依存関係をインストール
npm install
```

#### 0.2.2 環境変数の設定
```bash
# .env.localファイルを作成
touch .env.local

# 以下の内容を.env.localに追加
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

#### 0.2.3 Supabase設定（オプション）
1. [Supabase](https://supabase.com)でプロジェクトを作成
2. プロジェクトのURLとanon keyを取得
3. `.env.local`に設定を追加
4. `supabase/schema.sql`を実行してデータベーススキーマを作成

### 0.3 サーバーの起動方法

#### 0.3.1 開発サーバーの起動
```bash
# 開発サーバーを起動
npm run dev

# または
yarn dev
```

#### 0.3.2 起動確認
- ブラウザで `http://localhost:3000` にアクセス
- トップページが正常に表示されることを確認

#### 0.3.3 ビルドテスト（本番環境シミュレーション）
```bash
# プロダクションビルド
npm run build

# プロダクションサーバー起動
npm start
```

### 0.4 テストデータの準備

#### 0.4.1 初期データの確認
システムには以下の初期データが含まれています：

**質問データ** (`src/data/questions.ts`)
- 読書の目的（4選択肢）
- 興味のあるジャンル（8選択肢）

**モック書籍データ** (`src/lib/recommendation.ts`)
- 10冊のサンプル書籍
- 各書籍にタグ、説明、Amazonリンクが設定済み

**データベース初期データ** (`supabase/schema.sql`)
- タグマスター（25個のタグ）
- 質問マッピング（12個のマッピング）
- サンプル書籍（10冊）

#### 0.4.2 管理者アカウント
- **メールアドレス**: `noap3b69n@gmail.com`
- **パスワード**: `19930322`

### 0.5 テスト環境の確認

#### 0.5.1 基本動作確認
1. トップページの表示
2. ハンバーガーメニューの動作
3. 質問ページへの遷移
4. 管理者ログイン機能

#### 0.5.2 データベース接続確認
1. Supabase接続が正常に動作することを確認
2. 接続できない場合はモックデータで動作することを確認

#### 0.5.3 レスポンシブデザイン確認
1. PC（1920x1080）での表示
2. タブレット（768x1024）での表示
3. スマートフォン（375x667）での表示

### 0.6 トラブルシューティング

#### 0.6.1 よくある問題と解決方法

**ポート3000が使用中の場合**
```bash
# 別のポートで起動
npm run dev -- -p 3001
```

**依存関係のエラー**
```bash
# node_modulesを削除して再インストール
rm -rf node_modules package-lock.json
npm install
```

**Supabase接続エラー**
- 環境変数が正しく設定されているか確認
- Supabaseプロジェクトが有効か確認
- ネットワーク接続を確認

**ビルドエラー**
```bash
# TypeScriptエラーの確認
npm run lint

# 型チェック
npx tsc --noEmit
```

### 0.7 テスト実行前チェックリスト

#### 0.7.1 環境チェック
- [x] Node.js v18.0.0以上がインストールされている
- [x] npm v9.0.0以上がインストールされている
- [x] プロジェクトが正常にクローンされている
- [x] 依存関係が正常にインストールされている

#### 0.7.2 サーバーチェック
- [x] 開発サーバーが正常に起動している
- [x] `http://localhost:3000`でアクセス可能
- [x] トップページが正常に表示される
- [ ] エラーがコンソールに表示されていない

#### 0.7.3 機能チェック
- [ ] ハンバーガーメニューが動作する
- [x] 質問ページに遷移できる
- [x] 管理者ログインが動作する
- [x] レスポンシブデザインが正常に動作する

#### 0.7.4 データチェック
- [x] 質問データが正常に表示される
- [x] レコメンド機能が動作する
- [x] モックデータが正常に表示される
- [ ] 管理者機能が正常に動作する

---

## 1. テスト概要

### 1.1 システム名
一冊読書 - AIパーソナライズド書籍レコメンデーションシステム

### 1.2 テスト目的
- エンドユーザーの要求に対してシステムが正しく動作することを確認
- ユーザビリティとユーザーエクスペリエンス（UX）の品質を検証
- 実際の利用シナリオでの動作を確認

### 1.3 テスト範囲
- 一般ユーザー向け機能（書籍レコメンド）
- 管理者向け機能（データ管理）
- 認証・認可機能
- レスポンシブデザイン対応

### 1.4 テスト環境
- ブラウザ: Chrome最新版、Safari最新版、Firefox最新版
- デバイス: PC、タブレット、スマートフォン
- URL: http://localhost:3000（開発環境）

---

## 2. 一般ユーザー機能テスト

### 2.1 トップページ表示・ナビゲーション

#### テストケース UAT-001: トップページ初期表示
**テスト手順:**
1. ブラウザでトップページにアクセス
2. ページの表示内容を確認

**期待結果:**
- [x] ヘッダーにロゴ「📚 一冊読書」が表示されている
- [x] ハンバーガーメニューが右上に表示されている
- [x] メインタイトル「あなたにぴったりの一冊を見つけよう」が表示されている
- [x] 「たった2つの質問に答えるだけで...」のサブタイトルが表示されている
- [x] 「📚 質問に答えて本を探す」のCTAボタンが表示されている
- [x] Features、Stats、CTA、Footerの各セクションが表示されている

#### テストケース UAT-002: ハンバーガーメニュー動作
**テスト手順:**
1. ハンバーガーメニューをクリック
2. メニュー項目を確認
3. 各項目の動作を確認

**期待結果:**
- [x] メニューがスライドダウンで表示される
- [x] 「📝 質問に答える」「⚙️ 管理者画面」が表示される
- [x] 「質問に答える」クリックで質問ページに遷移する
- [x] メニュー外をクリックすると閉じる

#### テストケース UAT-003: レスポンシブデザイン確認
**テスト手順:**
1. PC、タブレット、スマートフォンでページを表示
2. 各デバイスでの表示を確認

**期待結果:**
- [x] 各デバイスで適切にレイアウトが調整されている
- [x] テキストが読みやすいサイズで表示されている
- [x] ボタンがタップしやすいサイズになっている

### 2.2 質問回答機能

#### テストケース UAT-004: 質問ページ表示
**テスト手順:**
1. トップページからCTAボタンをクリック
2. 質問ページの表示を確認

**期待結果:**
- [x] プログレスインジケーターが「1/2」を表示している
- [x] 質問1「読書の目的は何ですか？」が表示されている
- [x] 4つの選択肢が表示されている：
  - 知識・教養を身につけたい（🧠）
  - スキルアップしたい（🚀）
  - 自己成長したい（🌱）
  - リラックス・娯楽（😊）
- [x] 各選択肢にアイコンと説明が表示されている

#### テストケース UAT-005: 質問1回答
**テスト手順:**
1. 質問1で任意の選択肢をクリック
2. 自動遷移を確認

**期待結果:**
- [x] 選択した選択肢がハイライトされる
- [x] 300ms後に自動で質問2に遷移する
- [x] プログレスインジケーターが「2/2」に更新される

#### テストケース UAT-006: 質問2回答
**テスト手順:**
1. 質問2「どんなジャンルに興味がありますか？」を確認
2. 複数の選択肢を選択
3. 「次へ」ボタンをクリック

**期待結果:**
- [x] 8つのジャンル選択肢が表示されている：
  - 自己啓発（💪）
  - ビジネス・経済（💼）
  - 心理学（🧭）
  - 哲学・思想（🤔）
  - 歴史・社会（📚）
  - 科学・技術（🔬）
  - 健康・ライフスタイル（🏃）
  - 小説・文学（📖）
- [x] 複数選択が可能
- [x] 選択した項目がハイライトされる
- [x] 1つ以上選択すると「次へ」ボタンが有効になる
- [x] 「次へ」クリックで結果ページに遷移する

#### テストケース UAT-007: 戻るボタン動作
**テスト手順:**
1. 質問2で「← 戻る」ボタンをクリック
2. 質問1に戻ることを確認
3. 前回の選択が保持されていることを確認

**期待結果:**
- [x] 質問1に戻る
- [x] 前回選択した内容が保持されている
- [x] プログレスインジケーターが正しく更新される

### 2.3 推薦結果表示機能

#### テストケース UAT-008: 結果ページ表示
**テスト手順:**
1. 質問を最後まで回答
2. 結果ページの表示を確認

**期待結果:**
- [x] 「あなたにおすすめの本」のタイトルが表示されている
- [x] 推薦書籍がカード形式で表示されている
- [x] 各書籍カードに以下が含まれている：
  - 順位バッジ（#1, #2...）
  - マッチ率（%）
  - 書籍タイトル（最大2行）
  - 著者名
  - ジャンルタグ（最大3個）
  - 説明文（最大3行）
  - おすすめの理由（最大2個）
  - ページ数・価格情報
  - Amazonリンクボタン
  - 要約リンクボタン（ある場合）

#### テストケース UAT-009: 書籍カードの整列確認
**テスト手順:**
1. 複数の書籍カードを確認
2. カード内要素の配置を確認

**期待結果:**
- [x] 全ての書籍カードが同じ高さに整列されている
- [x] Amazonボタンが全て同じ位置にある
- [x] 説明文の長さに関係なく要素が整列している

#### テストケース UAT-010: リンク動作確認
**テスト手順:**
1. 各書籍の「📚 Amazonで見る」ボタンをクリック
2. 要約リンクがある場合は要約ボタンをクリック
3. 「🔄 もう一度質問に答える」ボタンをクリック

**期待結果:**
- [x] Amazonリンクが新しいタブで開く
- [x] 要約リンクが新しいタブで開く（ある場合）
- [x] 要約リンクがない場合は「📝 要約なし」の無効化されたボタンが表示される
- [x] 再質問ボタンで質問ページに戻る

---

## 3. 管理者機能テスト

### 3.1 認証機能

#### テストケース UAT-011: ログイン機能
**テスト手順:**
1. ハンバーガーメニューから「管理者画面」をクリック
2. ログインモーダルが表示されることを確認
3. 正しい認証情報を入力してログイン

**期待結果:**
- [x] ログインモーダルが表示される
- [x] メールアドレス：`noap3b69n@gmail.com`
- [x] パスワード：`19930322`
- [x] 正しい情報でログイン成功し、管理画面に遷移する

#### テストケース UAT-012: 認証失敗処理
**テスト手順:**
1. 間違った認証情報でログインを試行
2. エラーメッセージを確認

**期待結果:**
- [x] 「メールアドレスまたはパスワードが正しくありません」エラーが表示される
- [x] ログインに失敗し、モーダルが閉じない

#### テストケース UAT-013: 認証状態の永続化
**テスト手順:**
1. ログイン後、ページをリロード
2. 認証状態が保持されることを確認

**期待結果:**
- [x] リロード後も認証状態が保持されている
- [x] 管理画面に直接アクセスできる

### 3.2 書籍管理機能

#### テストケース UAT-014: 書籍一覧表示
**テスト手順:**
1. 管理画面にアクセス
2. 書籍一覧の表示を確認

**期待結果:**
- [x] 登録済み書籍がカード形式で表示される
- [x] 書籍情報（タイトル、著者、タグ、ページ数、価格）が表示される
- [x] 編集・削除ボタンが表示される

#### テストケース UAT-015: 新規書籍登録
**テスト手順:**
1. 「📚 新しい書籍を追加」ボタンをクリック
2. 必須項目を入力してフォーム送信
3. 書籍が追加されることを確認

**期待結果:**
- [x] 書籍登録フォームが表示される
- [x] 必須項目：タイトル、著者、ジャンルタグ、Amazonリンク
- [x] オプション項目：ページ数、価格、説明、要約リンク、表紙画像URL
- [x] タグマスターに存在するタグのみ選択可能
- [x] 登録後、書籍一覧に反映される

#### テストケース UAT-016: 書籍編集・削除
**テスト手順:**
1. 既存書籍の「✏️ 編集」ボタンをクリック
2. 情報を変更して更新
3. 「🗑️ 削除」ボタンで書籍を削除

**期待結果:**
- [x] 編集フォームに既存データが入力済み
- [x] 変更内容が正しく保存される
- [x] 削除時に確認ダイアログが表示される
- [x] 削除後、一覧から除外される

### 3.3 タグマスター管理

#### テストケース UAT-017: タグ一覧表示
**テスト手順:**
1. 管理画面から「🏷️ タグマスター管理」をクリック
2. タグ一覧の表示を確認

**期待結果:**
- [x] カテゴリ別にタグが表示される：
  - ジャンル
  - 知識・教養
  - スキル
  - 自己成長
  - リラックス
  - 共通
- [x] 各タグに名前、説明、表示順、作成日が表示される
- [x] 編集・削除ボタンが表示されない（読み取り専用）
- [x] 「読み取り専用」の表示がある

### 3.4 質問マッピング管理

#### テストケース UAT-018: マッピング一覧表示
**テスト手順:**
1. 管理画面から「🔗 質問マッピング管理」をクリック
2. マッピング一覧を確認

**期待結果:**
- [x] 目的とジャンルの2つの質問のみ表示される
- [x] 各マッピングに選択肢、マッピングタグ、重みが表示される
- [x] 編集・削除ボタンが機能する

#### テストケース UAT-019: マッピング追加・編集
**テスト手順:**
1. 「🔗 新しいマッピングを追加」をクリック
2. 質問、選択肢、タグ、重みを設定
3. 保存して一覧に反映されることを確認

**期待結果:**
- [x] 目的・ジャンルの質問のみ選択可能
- [x] タグマスターに存在するタグのみ選択可能
- [x] 重みは0.0-2.0の範囲で設定可能
- [x] 保存後、一覧に反映される

### 3.5 認証保護機能

#### テストケース UAT-020: 未認証アクセス制御
**テスト手順:**
1. ログアウト状態で管理画面URLに直接アクセス
2. 認証チェックの動作を確認

**期待結果:**
- [x] 管理画面にアクセスできない
- [x] トップページにリダイレクトされる
- [x] または認証確認中の画面が表示される

#### テストケース UAT-021: ログアウト機能
**テスト手順:**
1. ログイン状態でハンバーガーメニューを開く
2. 「🚪 ログアウト」をクリック
3. ログアウト処理を確認

**期待結果:**
- [x] ログアウトが実行される
- [x] トップページにリダイレクトされる
- [x] 管理画面に再アクセスできない状態になる

---

## 4. パフォーマンステスト

### 4.1 レスポンス時間

#### テストケース UAT-022: ページ読み込み時間
**テスト手順:**
1. 各ページの初期読み込み時間を測定
2. ネットワーク速度による影響を確認

**期待結果:**
- [x] トップページ：3秒以内
- [x] 質問ページ：2秒以内  
- [x] 結果ページ：5秒以内（レコメンド処理含む）
- [x] 管理画面：3秒以内

#### テストケース UAT-023: レコメンド処理時間
**テスト手順:**
1. 質問回答からレコメンド結果表示までの時間を測定
2. Supabase利用時とモックデータ時を比較

**期待結果:**
- [x] Supabase利用時：5秒以内
- [x] モックデータ時：2秒以内
- [x] 処理中はローディング表示される

---

## 5. 互換性テスト

### 5.1 ブラウザ互換性

#### テストケース UAT-024: 主要ブラウザでの動作確認
**テスト手順:**
1. Chrome、Safari、Firefox、Edgeで全機能をテスト
2. JavaScript機能の動作を確認

**期待結果:**
- [x] 全ブラウザで正常に動作する
- [x] UI表示に大きな差異がない
- [x] インタラクション機能が正常に動作する

### 5.2 デバイス互換性

#### テストケース UAT-025: レスポンシブデザイン確認
**テスト手順:**
1. PC（1920x1080）、タブレット（768x1024）、スマートフォン（375x667）でテスト
2. 各デバイスでの操作性を確認

**期待結果:**
- [x] 全デバイスで適切にレイアウトされる
- [x] タッチデバイスで操作しやすい
- [x] テキストが読みやすいサイズで表示される

---

## 6. セキュリティテスト

### 6.1 認証セキュリティ

#### テストケース UAT-026: 認証情報の保護
**テスト手順:**
1. ブラウザの開発者ツールでローカルストレージを確認
2. 認証情報の暗号化状態を確認

**期待結果:**
- [x] パスワードがローカルストレージに平文で保存されていない
- [x] 認証トークンが適切に管理されている

#### テストケース UAT-027: 不正アクセス防止
**テスト手順:**
1. 間違った認証情報で複数回ログイン試行
2. 管理画面への直接URL アクセス試行

**期待結果:**
- [x] 認証失敗時に適切なエラーメッセージが表示される
- [x] 未認証状態では管理画面にアクセスできない

---

## 7. エラーハンドリングテスト

### 7.1 ネットワークエラー処理

#### テストケース UAT-028: オフライン状態での動作
**テスト手順:**
1. ネットワークを切断した状態で操作
2. エラーメッセージの表示を確認

**期待結果:**
- [x] 適切なエラーメッセージが表示される
- [x] モックデータでの動作に切り替わる（該当機能）
- [x] ユーザーに状況が分かりやすく表示される

### 7.2 データエラー処理

#### テストケース UAT-029: 不正なデータ入力
**テスト手順:**
1. フォームに不正なデータを入力
2. バリデーションエラーの表示を確認

**期待結果:**
- [x] 適切なバリデーションメッセージが表示される
- [x] 必須項目の入力漏れが分かりやすく示される
- [x] データ形式エラーが適切に処理される

### 7.3 Supabase接続エラー処理

#### テストケース UAT-030: データベース接続失敗時の動作
**テスト手順:**
1. Supabase接続が失敗した状態でレコメンド機能を使用
2. エラーハンドリングの動作を確認

**期待結果:**
- [x] 「レコメンデーションの取得に失敗しました」エラーメッセージが表示される
- [x] サンプルデータが表示される
- [x] 「サンプルデータを表示しています」の説明が表示される

---

## 8. ユーザビリティテスト

### 8.1 操作性

#### テストケース UAT-031: 直感的な操作
**テスト手順:**
1. 初回ユーザーの想定で一連の操作を実行
2. 迷いやすいポイントを確認

**期待結果:**
- [x] 操作手順が直感的で分かりやすい
- [x] ボタンやリンクがクリック/タップしやすい
- [x] フィードバックが適切に表示される

#### テストケース UAT-032: アクセシビリティ
**テスト手順:**
1. キーボードのみでの操作を試行
2. 色覚異常ユーザーの視点で確認

**期待結果:**
- [x] Tabキーでの要素移動が適切
- [x] Enterキーでの操作が可能
- [x] 色に依存しない情報伝達ができている

---

## 9. レコメンドロジックテスト

### 9.1 スコアリング精度

#### テストケース UAT-033: 目的マッチング精度
**テスト手順:**
1. 各目的（knowledge, skill, growth, relaxation）で質問に回答
2. 推薦される書籍の適合性を確認

**期待結果:**
- [x] 知識・教養選択時：教養、歴史、哲学、科学関連の書籍が上位に表示される
- [x] スキルアップ選択時：ビジネス、スキルアップ関連の書籍が上位に表示される
- [x] 自己成長選択時：自己啓発、心理学関連の書籍が上位に表示される
- [x] リラックス選択時：小説、エンタメ関連の書籍が上位に表示される

#### テストケース UAT-034: ジャンルマッチング精度
**テスト手順:**
1. 複数のジャンルを選択して質問に回答
2. 選択したジャンルに関連する書籍が推薦されることを確認

**期待結果:**
- [x] 選択したジャンルに関連する書籍が上位に表示される
- [x] 複数ジャンル選択時は、それらに関連する書籍がバランスよく表示される
- [x] マッチ率が適切に計算されている

---

## 10. テスト実行記録

### 10.1 テスト実行環境
- **実行日**: _______________
- **実行者**: _______________  
- **ブラウザ**: _______________
- **OS**: _______________
- **画面解像度**: _______________

### 10.2 テスト結果サマリー
- **実行テストケース数**: 34
- **成功**: _____ / 34
- **失敗**: _____ / 34
- **保留**: _____ / 34

### 10.3 不具合一覧
| No | テストケース | 不具合内容 | 重要度 | 状態 |
|----|-------------|-----------|-------|------|
| 1  |             |           |       |      |
| 2  |             |           |       |      |
| 3  |             |           |       |      |

### 10.4 改善提案
| No | 項目 | 提案内容 | 優先度 |
|----|------|---------|-------|
| 1  |      |         |       |
| 2  |      |         |       |
| 3  |      |         |       |

---

## 11. 承認

### 11.1 テスト完了承認
- **テスト責任者**: _________________ 日付: _______
- **プロダクトオーナー**: _____________ 日付: _______
- **開発責任者**: _________________ 日付: _______

### 11.2 リリース承認
本ユーザー受け入れテストの結果、システムがユーザー要求を満たしていることを確認し、本番リリースを承認します。

**承認者**: _________________ 日付: _______
