# ðŸ“˜ ç´¹ä»‹è€…ï¼ˆIntroducerï¼‰æ©Ÿèƒ½ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦
ä¸€æ®µèª­æ›¸ã«ã€Œæœ¬ã®ç´¹ä»‹è€…ã€æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰æ©Ÿèƒ½ã®åˆ©ç”¨ã¾ã§ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‚’èª¬æ˜Žã—ã¾ã™ã€‚

## ðŸ“‹ å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### âœ… å®Œäº†æ¸ˆã¿
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒžè¨­è¨ˆï¼ˆintroducers ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
- âœ… TypeScriptåž‹å®šç¾©ï¼ˆIntroduceråž‹ï¼‰
- âœ… ç®¡ç†ç”»é¢UIï¼ˆ/admin/introducersï¼‰
  - ç´¹ä»‹è€…ä¸€è¦§ãƒ»æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿
  - æ–°è¦ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
  - è‡ªå‹•ä¿å­˜æ©Ÿèƒ½
  - é‡è¤‡è­¦å‘Š
  - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… å…¬é–‹å´UIï¼ˆ/introducers/[id]ï¼‰
  - ç´¹ä»‹è€…è©³ç´°ãƒšãƒ¼ã‚¸
  - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯
  - ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- âœ… ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ
  - ManagementSelectorã«è¿½åŠ 
  - AdminDashboardã«çµ±è¨ˆè¡¨ç¤º
  - ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³

### ðŸ”„ ä»Šå¾Œã®æ‹¡å¼µï¼ˆMVPå¤–ï¼‰
- ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- æ›¸ç±ã¨ã®ç´ä»˜ã‘UIï¼ˆbook_introducersä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
- ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½
- ç´¹ä»‹è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°

## ðŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### 1. ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œ
```sql
-- supabase/migration_add_introducers_table.sql ã‚’å®Ÿè¡Œ
psql -h [HOST] -U [USERNAME] -d [DATABASE] -f supabase/migration_add_introducers_table.sql
```

ã¾ãŸã¯ Supabase Dashboard ã® SQL Editor ã§å®Ÿè¡Œï¼š

```sql
-- pg_trgmæ‹¡å¼µãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆéƒ¨åˆ†ä¸€è‡´æ¤œç´¢ç”¨ï¼‰
CREATE EXTENSION IF NOT EXISTS pg_trgm;

-- ç´¹ä»‹è€…ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE IF NOT EXISTS public.introducers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  profile_url TEXT,
  description TEXT,
  is_active BOOLEAN NOT NULL DEFAULT true,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  created_by UUID REFERENCES auth.users(id)
);

-- æ›´æ–°æ—¥æ™‚ã®è‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
CREATE TRIGGER update_introducers_updated_at 
    BEFORE UPDATE ON public.introducers 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ
CREATE INDEX IF NOT EXISTS idx_introducers_name ON public.introducers USING gin (name gin_trgm_ops);
CREATE INDEX IF NOT EXISTS idx_introducers_description ON public.introducers USING gin (description gin_trgm_ops);
CREATE INDEX IF NOT EXISTS idx_introducers_is_active ON public.introducers (is_active);
CREATE INDEX IF NOT EXISTS idx_introducers_created_at ON public.introducers (created_at DESC);

-- åˆ¶ç´„ã®è¿½åŠ 
ALTER TABLE public.introducers ADD CONSTRAINT chk_introducers_profile_url
  CHECK (profile_url IS NULL OR profile_url ~* '^(https?)://');
ALTER TABLE public.introducers ADD CONSTRAINT chk_introducers_name_length
  CHECK (char_length(name) >= 1 AND char_length(name) <= 100);
ALTER TABLE public.introducers ADD CONSTRAINT chk_introducers_description_length
  CHECK (description IS NULL OR char_length(description) <= 300);

-- RLSè¨­å®š
ALTER TABLE public.introducers ENABLE ROW LEVEL SECURITY;

CREATE POLICY "introducers_select_public" ON public.introducers
  FOR SELECT USING (true);

CREATE POLICY "introducers_write_admin" ON public.introducers
  FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM public.user_roles ur 
      WHERE ur.user_id = auth.uid() AND ur.role = 'admin'
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM public.user_roles ur 
      WHERE ur.user_id = auth.uid() AND ur.role = 'admin'
    )
  );
```

### 2. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```sql
INSERT INTO public.introducers (name, profile_url, description, is_active) VALUES
('æ± ä¸Šå½°', 'https://www.tv-asahi.co.jp/ikegami/', 'ã‚¸ãƒ£ãƒ¼ãƒŠãƒªã‚¹ãƒˆã€‚è¤‡é›‘ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ã‚ã‹ã‚Šã‚„ã™ãè§£èª¬ã™ã‚‹ã“ã¨ã§çŸ¥ã‚‰ã‚Œã‚‹ã€‚æ•™è‚²ç•ªçµ„ã®å¸ä¼šã‚‚å¤šæ•°æ‹…å½“ã€‚', true),
('ä½è—¤å„ª', 'https://ja.wikipedia.org/wiki/ä½è—¤å„ª_(ä½œå®¶)', 'å…ƒå¤–å‹™çœä¸»ä»»åˆ†æžå®˜ã€ä½œå®¶ã€‚å›½éš›æƒ…å‹¢åˆ†æžã‚„æ•™é¤Šæ›¸ã®åŸ·ç­†ã§æ´»èºã€‚å¹…åºƒã„çŸ¥è­˜ã¨ç‹¬è‡ªã®è¦–ç‚¹ã§æ›¸ç±ã‚’ç´¹ä»‹ã€‚', true),
('æž—ä¿®', 'https://www.watanabepro.co.jp/mypage/artist/hayashiosamu.html', 'äºˆå‚™æ ¡è¬›å¸«ã€ã‚¿ãƒ¬ãƒ³ãƒˆã€‚ã€Œã„ã¤ã‚„ã‚‹ã‹ï¼Ÿä»Šã§ã—ã‚‡ï¼ã€ã§æœ‰åã€‚æ•™è‚²é–¢é€£ã®æ›¸ç±ç´¹ä»‹ã«å®šè©•ãŒã‚ã‚‹ã€‚', true),
('ä¸­ç”°æ•¦å½¦', 'https://www.youtube.com/c/NakataUniversity', 'ãŠç¬‘ã„èŠ¸äººã€æ•™è‚²ç³»YouTuberã€‚ã€Œä¸­ç”°æ•¦å½¦ã®YouTubeå¤§å­¦ã€ã§æ§˜ã€…ãªæ›¸ç±ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ã€‚', true),
('ãƒ¡ãƒ³ã‚¿ãƒªã‚¹ãƒˆDaiGo', 'https://daigo.me/', 'ãƒ¡ãƒ³ã‚¿ãƒªã‚¹ãƒˆã€ä½œå®¶ã€‚å¿ƒç†å­¦ã‚„ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ã„ãŸæ›¸ç±ã®ç´¹ä»‹ã§äººæ°—ã€‚åŠ¹çŽ‡çš„ãªå­¦ç¿’æ³•ã‚‚ææ¡ˆã€‚', true),
('ã²ã‚ã‚†ã', 'https://twitter.com/hiroyuki_ni', 'å®Ÿæ¥­å®¶ã€è«–ç ´çŽ‹ã€‚ç‹¬ç‰¹ã®è¦–ç‚¹ã§ç¤¾ä¼šå•é¡Œã‚„å“²å­¦æ›¸ã‚’ç´¹ä»‹ã€‚è¾›å£ã‚³ãƒ¡ãƒ³ãƒˆã§ã‚‚çŸ¥ã‚‰ã‚Œã‚‹ã€‚', true),
('æœ¬è¦ç´„ãƒãƒ£ãƒ³ãƒãƒ«', 'https://www.youtube.com/c/æœ¬è¦ç´„ãƒãƒ£ãƒ³ãƒãƒ«', 'YouTubeãƒãƒ£ãƒ³ãƒãƒ«ã€‚ãƒ“ã‚¸ãƒã‚¹æ›¸ã‚„è‡ªå·±å•“ç™ºæ›¸ã®è¦ç´„ã‚’åˆ†ã‹ã‚Šã‚„ã™ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ç”»ã§ç´¹ä»‹ã€‚', true),
('èª­æ›¸çŒ¿', 'https://readingmonkey.blog.fc2.com/', 'ãƒ–ãƒ­ã‚¬ãƒ¼ã€ä½œå®¶ã€‚ã€Œç‹¬å­¦å¤§å…¨ã€ã®è‘—è€…ã€‚å­¦ç¿’æ³•ã‚„èª­æ›¸è¡“ã«é–¢ã™ã‚‹æ·±ã„çŸ¥è­˜ã§æ›¸ç±ã‚’ç´¹ä»‹ã€‚', true)
ON CONFLICT DO NOTHING;
```

## ðŸŽ¯ åˆ©ç”¨æ–¹æ³•

### ç®¡ç†è€…å‘ã‘ï¼ˆAdminï¼‰

#### 1. ç´¹ä»‹è€…ç®¡ç†ç”»é¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
- URL: `/admin/introducers`
- ç®¡ç†ç”»é¢ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€Œç´¹ä»‹è€…ç®¡ç†ã€ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯
- ã¾ãŸã¯ä¸Šéƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ðŸ‘¤ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

#### 2. æ–°è¦ç´¹ä»‹è€…ã®ä½œæˆ
1. ã€Œ+ æ–°è¦ç´¹ä»‹è€…ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å¿…é ˆé …ç›®ã‚’å…¥åŠ›ï¼š
   - **ç´¹ä»‹è€…å**ï¼ˆå¿…é ˆã€1-100æ–‡å­—ï¼‰
   - **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URL**ï¼ˆä»»æ„ã€http/httpså½¢å¼ï¼‰
   - **èª¬æ˜Ž**ï¼ˆä»»æ„ã€æœ€å¤§300æ–‡å­—ï¼‰
3. ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

#### 3. ç´¹ä»‹è€…ã®ç·¨é›†
1. ä¸€è¦§ã‹ã‚‰ç·¨é›†ã—ãŸã„ç´¹ä»‹è€…ã®ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œç·¨é›†ã€ã‚’é¸æŠž
3. ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€å†…å®¹ã‚’ä¿®æ­£
4. è‡ªå‹•ä¿å­˜æ©Ÿèƒ½ã«ã‚ˆã‚Šã€å…¥åŠ›ä¸­ã«è‡ªå‹•ã§ä¿å­˜ã•ã‚Œã¾ã™

#### 4. ç´¹ä»‹è€…ã®å‰Šé™¤
1. ä¸€è¦§ã‹ã‚‰å‰Šé™¤ã—ãŸã„ç´¹ä»‹è€…ã®ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œå‰Šé™¤ã€ã‚’é¸æŠž
3. ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã€ŒOKã€ã‚’ã‚¯ãƒªãƒƒã‚¯

#### 5. æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½
- **æ¤œç´¢**: ç´¹ä»‹è€…åã‚„èª¬æ˜Žæ–‡ã§ã®éƒ¨åˆ†ä¸€è‡´æ¤œç´¢
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éžã‚¢ã‚¯ãƒ†ã‚£ãƒ–/ã™ã¹ã¦

### ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘

#### ç´¹ä»‹è€…è©³ç´°ãƒšãƒ¼ã‚¸
- URL: `/introducers/[id]`
- ç´¹ä»‹è€…ã®åŸºæœ¬æƒ…å ±ï¼ˆåå‰ã€èª¬æ˜Žã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ï¼‰ã‚’è¡¨ç¤º
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã®ã‚¯ãƒªãƒƒã‚¯ã¯å¤–éƒ¨ã‚µã‚¤ãƒˆã§é–‹ãã¾ã™
- å°†æ¥çš„ã«ç´¹ä»‹æ›¸ç±ä¸€è¦§ã‚‚è¡¨ç¤ºäºˆå®š

## ðŸ”’ æ¨©é™ç®¡ç†

### RLSï¼ˆRow Level Securityï¼‰ãƒãƒªã‚·ãƒ¼
- **èª­ã¿å–ã‚Š**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆpublicï¼‰
- **æ›¸ãè¾¼ã¿**: Adminæ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿

### å¿…è¦ãªæ¨©é™è¨­å®š
ç®¡ç†æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€`user_roles`ãƒ†ãƒ¼ãƒ–ãƒ«ã§`role = 'admin'`ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

## ðŸ“Š ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹

### å®Ÿè£…æ¸ˆã¿ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
- `introducer_detail_viewed`: ç´¹ä»‹è€…è©³ç´°ãƒšãƒ¼ã‚¸è¡¨ç¤º
- `introducer_profile_clicked`: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯

### å°†æ¥å®Ÿè£…äºˆå®š
- `introducer_list_viewed`: ä¸€è¦§ãƒšãƒ¼ã‚¸è¡¨ç¤º
- `introducer_created/updated/deleted`: ç®¡ç†è€…æ“ä½œ

## ðŸ§ª ãƒ†ã‚¹ãƒˆè¦³ç‚¹

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… å¿…é ˆé …ç›®ï¼ˆåå‰ï¼‰ã®æœªå…¥åŠ›ãƒã‚§ãƒƒã‚¯
- âœ… åå‰ã®æ–‡å­—æ•°åˆ¶é™ï¼ˆ1-100æ–‡å­—ï¼‰
- âœ… èª¬æ˜Žã®æ–‡å­—æ•°åˆ¶é™ï¼ˆ0-300æ–‡å­—ï¼‰
- âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URLã®å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆhttp/httpsï¼‰

### æ¨©é™ãƒã‚§ãƒƒã‚¯
- âœ… éžAdmin ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãè¾¼ã¿æ“ä½œã¯403ã‚¨ãƒ©ãƒ¼
- âœ… å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª­ã¿å–ã‚Šå¯èƒ½

### UI/UX
- âœ… é‡è¤‡åã®è­¦å‘Šè¡¨ç¤º
- âœ… è‡ªå‹•ä¿å­˜æ©Ÿèƒ½
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## ðŸš¨ æ³¨æ„äº‹é …

### æ—¢çŸ¥ã®åˆ¶é™äº‹é …
1. **ç‰©ç†å‰Šé™¤**: MVPã§ã¯å‰Šé™¤æ™‚ã«è«–ç†å‰Šé™¤ã§ã¯ãªãç‰©ç†å‰Šé™¤ã‚’è¡Œã„ã¾ã™
2. **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒæ©Ÿèƒ½ã¯å°†æ¥å®Ÿè£…äºˆå®š
3. **æ›¸ç±ç´ä»˜ã‘**: æ›¸ç±ã¨ã®é–¢é€£ä»˜ã‘ã¯å°†æ¥å®Ÿè£…äºˆå®š

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
- XSSå¯¾ç­–: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¯é©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- URLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URLã®å½¢å¼ãƒã‚§ãƒƒã‚¯
- Adminæ¨©é™ãƒã‚§ãƒƒã‚¯: RLSãƒãƒªã‚·ãƒ¼ã§æ›¸ãè¾¼ã¿åˆ¶é™

## ðŸ”„ ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒžãƒƒãƒ—

### v1.1ï¼ˆæ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
- ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- è«–ç†å‰Šé™¤ã¸ã®å¤‰æ›´
- è¡¨ç¤ºãƒˆã‚°ãƒ«æ©Ÿèƒ½

### v1.2ï¼ˆæ›¸ç±é€£æºï¼‰
- `book_introducers`ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…
- æ›¸ç±è©³ç´°ãƒšãƒ¼ã‚¸ã§ã®ç´¹ä»‹è€…è¡¨ç¤º
- ç´¹ä»‹è€…è©³ç´°ãƒšãƒ¼ã‚¸ã§ã®ç´¹ä»‹æ›¸ç±ä¸€è¦§

### v1.3ï¼ˆã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ç´¹ä»‹è€…ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½
- ç´¹ä»‹è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- æ´»å‹•å±¥æ­´ã®å¯è¦–åŒ–

## ðŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â””â”€â”€ introducers/
â”‚   â”‚       â””â”€â”€ page.tsx              # ç®¡ç†ç”»é¢
â”‚   â””â”€â”€ introducers/
â”‚       â””â”€â”€ [id]/
â”‚           â””â”€â”€ page.tsx              # å…¬é–‹è©³ç´°ãƒšãƒ¼ã‚¸
â”œâ”€â”€ components/
â”‚   â””â”€â”€ admin/
â”‚       â”œâ”€â”€ ManagementSelector.tsx    # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ›´æ–°ï¼‰
â”‚       â””â”€â”€ AdminDashboard.tsx        # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆæ›´æ–°ï¼‰
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                      # åž‹å®šç¾©ï¼ˆæ›´æ–°ï¼‰
â””â”€â”€ supabase/
    â””â”€â”€ migration_add_introducers_table.sql  # DBãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```

## âœ… å—ã‘å…¥ã‚ŒåŸºæº–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] ç®¡ç†ç”»é¢ã‹ã‚‰ç´¹ä»‹è€…ã®æ–°è¦ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãƒ»æ¤œç´¢ãŒè¡Œãˆã‚‹
- [x] ç´¹ä»‹è€…è©³ç´°ãƒšãƒ¼ã‚¸ã§åŸºæœ¬3é …ç›®ï¼ˆåå‰ãƒ»èª¬æ˜Žãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] æ¨©é™å¤–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®POST/PATCH/DELETEã¯403ï¼ˆRLSãƒãƒªã‚·ãƒ¼ã§å®Ÿè£…ï¼‰
- [x] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»é‡è¤‡è­¦å‘ŠãŒUIã§æ©Ÿèƒ½ã™ã‚‹
- [x] ä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆãŒè¨ˆæ¸¬ã•ã‚Œã‚‹ï¼ˆã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°å®Ÿè£…æ¸ˆã¿ï¼‰
- [x] æ—¢å­˜UIã¨ã®ä¸€è²«æ€§ã‚’ä¿æŒ
- [x] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½

## ðŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ**
   ```bash
   # Supabase CLIã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
   supabase db push
   
   # ã¾ãŸã¯ç›´æŽ¥SQLã‚’å®Ÿè¡Œ
   psql -h [HOST] -U [USERNAME] -d [DATABASE] -f supabase/migration_add_introducers_table.sql
   ```

2. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   npm run build
   npm run start
   # ã¾ãŸã¯ Vercelç­‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤
   ```

3. **Adminæ¨©é™ã®è¨­å®š**
   ```sql
   -- ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«adminæ¨©é™ã‚’ä»˜ä¸Ž
   INSERT INTO public.user_roles (user_id, role) 
   VALUES ('[USER_UUID]', 'admin');
   ```

4. **å‹•ä½œç¢ºèª**
   - `/admin/introducers` ã«ã‚¢ã‚¯ã‚»ã‚¹
   - ç´¹ä»‹è€…ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã‚’ãƒ†ã‚¹ãƒˆ
   - `/introducers/[id]` ã§è©³ç´°ãƒšãƒ¼ã‚¸ã‚’ãƒ†ã‚¹ãƒˆ

## ðŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ã€ŒSupabaseãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã‚¨ãƒ©ãƒ¼
**åŽŸå› **: ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„
**è§£æ±ºæ–¹æ³•**: 
```bash
# .env.local ã«ä»¥ä¸‹ã‚’è¨­å®š
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

#### 2. æ¨©é™ã‚¨ãƒ©ãƒ¼ï¼ˆ403 Forbiddenï¼‰
**åŽŸå› **: Adminæ¨©é™ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
**è§£æ±ºæ–¹æ³•**: 
```sql
-- user_rolesãƒ†ãƒ¼ãƒ–ãƒ«ã§adminæ¨©é™ã‚’ç¢ºèªãƒ»ä»˜ä¸Ž
SELECT * FROM public.user_roles WHERE user_id = auth.uid();
INSERT INTO public.user_roles (user_id, role) VALUES (auth.uid(), 'admin');
```

#### 3. æ¤œç´¢æ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„
**åŽŸå› **: pg_trgmæ‹¡å¼µãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãªã„
**è§£æ±ºæ–¹æ³•**: 
```sql
CREATE EXTENSION IF NOT EXISTS pg_trgm;
```

#### 4. ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼
**åŽŸå› **: ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„
**è§£æ±ºæ–¹æ³•**: `supabase/migration_add_introducers_table.sql` ã‚’å®Ÿè¡Œ

## ðŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–

### å®Ÿè£…æ¸ˆã¿æœ€é©åŒ–
- GINã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹é«˜é€Ÿéƒ¨åˆ†ä¸€è‡´æ¤œç´¢
- è‡ªå‹•ä¿å­˜ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ©Ÿèƒ½ï¼ˆ1ç§’ï¼‰
- ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—
- RLSã«ã‚ˆã‚‹åŠ¹çŽ‡çš„ãªæ¨©é™ãƒã‚§ãƒƒã‚¯

### æŽ¨å¥¨è¨­å®š
- Supabaseã®æŽ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°è¨­å®š
- CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®šï¼ˆé™çš„ã‚¢ã‚»ãƒƒãƒˆï¼‰
- ç”»åƒæœ€é©åŒ–ï¼ˆå°†æ¥ã®ã‚¢ã‚¤ã‚³ãƒ³æ©Ÿèƒ½ç”¨ï¼‰

---

**å®Ÿè£…å®Œäº†æ—¥**: 2025-01-30  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™å®Œäº† âœ…