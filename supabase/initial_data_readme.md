# 一段読書システム 初期データ投入ガイド

このディレクトリには、一段読書システムの初期データ投入用SQLファイルが含まれています。

## ファイル構成

### 1. `initial_data_genre_tags.sql`
ジャンルタグの初期データを投入します。
- 基本ジャンル（自己啓発、ビジネス、心理学など）
- 目的関連タグ（教養、スキルアップ、成長など）
- 人物・企業タグ（起業家、企業名など）
- その他専門タグ（SF、数学、暗号など）

### 2. `initial_data_books.sql`
書籍の初期データを投入します。
- 88冊の書籍データ
- 各書籍にはタイトル、著者、ジャンルタグ、Amazonリンク、要約リンク、説明、ページ数、価格が含まれます
- ジャンルタグは配列形式で複数タグを設定可能

### 3. `initial_data_question_mappings.sql`
質問マッピングの初期データを投入します。
- 読書目的の質問（knowledge, skill, growth, relaxation）
- ジャンル選択の質問（複数選択可能）
- 各選択肢に対応するタグのマッピング

### 4. `initial_data_setup.sql`
システム設定を投入します。
- パフォーマンス向上のためのインデックス作成
- 更新日時の自動更新トリガー
- Row Level Security (RLS) 設定

## 実行順序

初期データを投入する際は、以下の順序で実行してください：

1. **スキーマ作成**: `schema.sql` を実行してテーブルを作成
2. **ジャンルタグ投入**: `initial_data_genre_tags.sql` を実行
3. **書籍データ投入**: `initial_data_books.sql` を実行
4. **質問マッピング投入**: `initial_data_question_mappings.sql` を実行
5. **システム設定**: `initial_data_setup.sql` を実行

## 実行方法

### Supabase CLI を使用する場合

```bash
# スキーマ作成
supabase db reset

# 初期データ投入（順番に実行）
psql -h your-project.supabase.co -U postgres -d postgres -f supabase/initial_data_genre_tags.sql
psql -h your-project.supabase.co -U postgres -d postgres -f supabase/initial_data_books.sql
psql -h your-project.supabase.co -U postgres -d postgres -f supabase/initial_data_question_mappings.sql
psql -h your-project.supabase.co -U postgres -d postgres -f supabase/initial_data_setup.sql
```

### Supabase Dashboard を使用する場合

1. Supabase Dashboard にログイン
2. プロジェクトを選択
3. SQL Editor を開く
4. 各SQLファイルの内容を順番にコピー&ペーストして実行

## データ内容

### ジャンルタグ（108個）
- **基本ジャンル**: 自己啓発、ビジネス、心理学、哲学、歴史、科学、健康、小説
- **目的関連**: 教養、スキルアップ、成功法則、習慣、人生論、コミュニケーション
- **人物・企業**: 起業家、江副浩正、藤田晋、堀江貴文、三木谷浩史、柳井正、Apple、ビズリーチ
- **専門分野**: SF、数学、暗号、ファッション、労働、子育て、経営、投資、デザイン、エンジニアリング

### 書籍（88冊）
- **ビジネス・起業家関連**: 9冊
- **自己啓発・心理学**: 5冊
- **エンターテイメント**: 1冊
- **SF・科学**: 3冊
- **ファッション・ライフスタイル**: 2冊
- **社会問題・労働**: 3冊
- **教育・子育て**: 1冊
- **経営・マネジメント**: 1冊
- **映画・エンタメ**: 1冊
- **リーダーシップ・マネジメント**: 1冊
- **経済・投資**: 2冊
- **サステナビリティ**: 2冊
- **小説・文学**: 2冊
- **思考・問題解決**: 2冊
- **建築・都市**: 1冊
- **技術・エンジニアリング**: 1冊
- **科学・物理**: 1冊
- **生活・食事**: 1冊
- **文学・小説**: 1冊
- **経済・ノーベル賞**: 1冊
- **コミュニケーション**: 1冊
- **政治・外交**: 1冊
- **洋書・マネジメント**: 1冊
- **健康・ライフスタイル**: 1冊
- **技術・プログラミング**: 1冊
- **事業開発・スケール**: 1冊
- **歴史・人類学**: 1冊
- **思考・問題解決**: 2冊
- **デザイン・UI**: 1冊
- **技術・HTML**: 1冊
- **思考・地頭力**: 1冊
- **小説・推理**: 2冊
- **組織・戦略**: 2冊
- **アジャイル・プロジェクト管理**: 4冊
- **小説・文学賞**: 4冊
- **小説・現代文学**: 2冊
- **投資・マネー**: 1冊
- **小説・文学**: 10冊
- **技術・歴史**: 1冊
- **スタートアップ・事業開発**: 1冊
- **起業家・ビジネス**: 2冊
- **技術・経営**: 1冊

### 質問マッピング
- **読書目的**: 4つの選択肢（教養、スキル、成長、リラックス）
- **ジャンル選択**: 8つの選択肢（自己啓発、ビジネス、心理学、哲学、歴史、科学、健康、小説）

## 注意事項

1. **実行順序**: 必ず指定された順序で実行してください
2. **重複実行**: 同じデータを重複して投入するとエラーが発生する可能性があります
3. **バックアップ**: 本番環境で実行する前に、必ずデータのバックアップを取得してください
4. **権限**: データ投入には適切なデータベース権限が必要です

## カスタマイズ

初期データをカスタマイズする場合は、各SQLファイルを編集してから実行してください。

- **ジャンルタグの追加**: `initial_data_genre_tags.sql` に新しいINSERT文を追加
- **書籍の追加**: `initial_data_books.sql` に新しいINSERT文を追加
- **質問マッピングの変更**: `initial_data_question_mappings.sql` を編集

## トラブルシューティング

### よくあるエラー

1. **重複キーエラー**: 既にデータが存在する場合
   - 解決策: テーブルをクリアしてから再実行

2. **外部キー制約エラー**: 参照先のデータが存在しない場合
   - 解決策: 実行順序を確認して再実行

3. **権限エラー**: データベース権限が不足している場合
   - 解決策: 適切な権限を持つユーザーで実行

### ログの確認

実行時にエラーが発生した場合は、Supabase Dashboard の Logs セクションで詳細を確認できます。
